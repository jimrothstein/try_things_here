---
TAGS:  pivot, nest, tidyr
---
# Simple Examples of the Messy Data 

# SEE https://tidyr.tidyverse.org/articles/tidy-data.html
- non-tidy
- tidy
- pivot_longer
- pivot_wider
- separate (one combo column, split into two)
# 
```{r}


library(dplyr)
library(tibble)
library(tidyr)
library(tibble)

# ------- Same data represented by different DATA STRUCTURES ---------
classroom <- tribble(
  ~name,    ~quiz1, ~quiz2, ~test1,
  "Billy",  NA,     "D",    "C",
  "Suzy",   "F",    NA,     NA,
  "Lionel", "B",    "C",    "B",
  "Jenny",  "A",    "A",    "B"
  )

# OR

tribble(
  ~assessment, ~Billy, ~Suzy, ~Lionel, ~Jenny,
  "quiz1",     NA,     "F",   "B",     "A",
  "quiz2",     "D",    NA,    "C",     "A",
  "test1",     "C",    NA,    "B",     "B"
  )

# ------------------------- Normalize---------------------

# OR  Tidy (normalize), where columns and rows HAVE MEANING (semantics)
#
str(classroom)
classroom |> head()
# # A tibble: 4 Ã— 4
#   name   quiz1 quiz2 test1
#   <chr>  <chr> <chr> <chr>
# 1 Billy  <NA>  D     C    
# 2 Suzy   F     <NA>  <NA> 
# 3 Lionel B     C     B    
# 4 Jenny  A     A     B    


##  To normalize:   index becomes (in effect) all combos name, quizes (assessment  )
(classroom2 <- classroom %>% 
  tidyr::pivot_longer(cols = quiz1:test1, 
    names_to = "assessment", 
    values_to = "grade") %>% 
  arrange(name, assessment))

##  inverse !  returns to orginal 
(classroom3  <- classroom  %>%  unnest_longer(name))




# ------------ relig_income----------------------------------
##  Normalize!   Create all combos religion x income, 
relig_income
str(relig_income)

relig2  <- relig_income %>% 
  tidyr::pivot_longer(cols = 2:11,  # also cols=-religion
  names_to = "income",
  values_to = "freqency") 
relig2
```
