---
title: "Date Imputation"
format: html
---


SEE: https://advance.hub.phuse.global/wiki/spaces/WEL/pages/26807243/Imputing+Partial+Dates
SEE: https://stefvanbuuren.name/fimd/
SEE: https://advance.hub.phuse.global/wiki/spaces/WEL/pages/26805267/Good+Programming+Practice+-+Standard+Program+Process+Supporting+Documentation 
"Program documentation can contain only a roadmap linking the different piece of code with input and output to each other. This is usually difficult to see when reading the program code and it does add value rather than just being descriptive. Program documentation must communicate what is central and subtle that cannot be reengineer from the source code and document rational for important design decisions.


## Break dtc into pieces, capture groups
```{r}
library(stringr)
 dtc = "2024-04-01"
 two <- "(\\d{2}|-?)"
  partialdate <- str_match(dtc, paste0(
    "(\\d{4}|-?)-?",
    two,
    "-?",
    two
  ))
partialdate
```

## Why Impute?
```
```

## How to Impute, ie RULES !    
```
"How you impute often depends on the type of date."

Given date 2009, you might insist on a day.
Is 2009-01-01 right choice?   Or would mid-year be better:   2009-06-30?   Or do you want date + time (2009-01-01T01:01:01)
-not about format;  it is about precision.

Likewise, if starting a new drug on 2009-02-15 and an Adverse Event( AE) follows but is given as 2009-02 how you impute matters.

```
Explain the two min dates
## Example: Adverse Event/Concommittant Medication. 
```{r}
# Medication begun 2020-11-11, but AE given as 2020-11
library(admiral)
library(lubridate)
impute_dtc_dtm(   #  [1] "2020-11-11T11:11:11"
  "2020-11",
  min_dates = list(
   ymd_hms("2020-12-06T12:12:12"),
   
   ymd_hms("2020-11-12T11:11:11"),
   ymd_hms("2020-11-11T11:11:11")
  ),
  highest_imputation = "M"
)

# no diff D or M?
impute_dtc_dtm(   #  [1] "2020-11-11T11:11:11"
  "2020-11",
  min_dates = list(
   ymd_hms("2020-12-06T12:12:12"),
   ymd_hms("2020-11-11T11:11:11")
  ),
  highest_imputation = "D"
)
```


##
In {admiral} we don't allow users to pick any single part of the date/time to impute, we only enable to impute up to a highest level, i.e. you couldn't choose to say impute months, but not days.


 Try to impute month for "2020----", won't do it
```{r}
impute_dtc_dtm(   #  [1] "2020-11-11T11:11:11"
  "2020-11",
  min_dates = list(
   ymd_hms("2020-12-06T12:12:12"),
   ymd_hms("2020-11-11T11:11:11")
  ),
  highest_imputation = "D"
)

# insists on highest_impute M (or NA)
impute_dtc_dt(
  dtc = "2020",
 # date_imputation = NULL,
 date_imputation = "NULL",
  highest_imputation = "D"
  )
```

