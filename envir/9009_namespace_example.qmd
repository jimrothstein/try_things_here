---
title: 9009_namespace
format:
  html:
    embed-resources: true
execute:
  enabled: true
--- 
 ##  Namespaces
 ##  Collect examples here
 
\footnotesize

#
##-------------------------------------
## NAMESPACES - See Ch 7.4.3
##-------------------------------------


## HELP
```{r}
apropos("environment")
apropos("namespace")
apropos("getNamespace")
```

### all installed packages
```{r}
installed.packages()
installed.packages() |> class()
ls()
```

### attached packages vs search()
```{r}
(.packages()) #22
search()  #24
z=paste0("package:", .packages())

z %in% search()
search()[!z %in% search()]

search()[!z %in% search()]
base::setdiff(z, search())
```

### is pkg loaded?
```{r}
"stats" %in% loadedNamespaces()  # TRUE
"admiral" %in% loadedNamespaces()   # T
"admiraldev" %in% loadedNamespaces()  # T
"broom" %in% loadedNamespaces()  # F

```
### getAnywhere (examine all loaded NS)
```{r}
?getAnywhere
argsAnywhere(derive_params)
getAnywhere(filter)
getAnywhere(ae)

# fct in pkg admiral
getAnywhere("count_vals")
getAnywhere(count_vals)

argsAnywhere(derive_params)
getAnywhere(filter)
getAnywhere(ae)

# fct in pkg admiral
getAnywhere("count_vals")
getAnywhere(count_vals)

# dataset in pkg (must be loaded)
library(pharmaversesdtm)
getAnywhere("ae")   # finds in package:pharamaversesdtm

# but will not find if unloaded
unloadNamespace("pharmaversesdtm")
```

## getNamespace, returns environment
```{r}
?help.start
library(pkgload)
getNamespace("admiral")   # Loads NS for admiral
isNamespaceLoaded("admiral")
unloadNamespace("admiral")
```
### objects in NameSpace
```{r} 
ls(getNamespace("dplyr"))

## Need better way ...
ls(getNamespace("admiral")) == "count_vals"  # T
getAnywhere("count_vals")

```
### is object in ns?
```{r}
z=ls(getNamespace("admiral"))

c("slice_derivation") %in% z   # TRUE
```

### Find data(), class packageIRQ
```{r}
# returns obj of class packageIRQ
data() |> class()

# data in one package
data(package = "tidyr")

# data in one package (not loaded)
isNamespaceLoaded("broom")  # F
data(package = "broom")
isNamespaceLoaded("broom") # F
```

### Find all 'loaded' ds?   means ...?
```{r}
```

### package versions?
```{r}
sessionInfo()   # uses package version from disk, not memory
getNamespaceVersion("admiral")  # better
```

### ds in pkg;   NOT 'exported', put into data/
```{r}
data()   # all loaded ds
data(package = "admiral")  # ds in package admiral; will NOT load NS admiral
ls(getNamespace("admiral"))   # will load NS admiral, ~ 176 objects


isNamespaceLoaded("admiral")
unloadNamespace("admiral")
data("admiral_adsl")   # not found
data("ae")  # not found
ls(getNamespace("pharmaversesdtm"))



# ae is dataset in pharmaversesdtm, in /data
library(pharmaversesdtm)  # must be loaded
ae   # found it
getAnywhere("ae")   # works

## pharamaversesdtm does NOT export much;  data/ is not called 'exported'
c("ae") %in% getNamespaceExports("pharmaversesdtm") # F

# but "ae" is in data/
str(data(package = "pharmaversesdtm"))
c("ae") %in% data(package = "pharmaversesdtm")$results

# because uses IQR format
z=data(package = "pharmaversesdtm")
z |> class()   # packageIQR
"ae" %in% z   # WHY FALSE?
"ae" %in% z$result   # NOW it is true!


ls(package:stats)
ls(package:admiral)


ls(ns:stats)
ls(namespace:stats)
ns:stats
namespace("stats")
ls(imports:stats)

z=getNamespaceImports("admiral")
class(z)
```

## probe package, imports, exports (seems to match file NAMESPACE)
```{r}
getNamespaceImports("stats")   # list
getNamespaceExports("stats")



getNamespaceImports("admiral")
getNamespaceExports("admiral")

```
