---
title: "102_... HELPER.qmd"  
author: "JR"  
date: "5/22/2021"  
pdf-engine: lualatex  
format:   
  html:  
        code-fold: true
        toc: true 
        toc_depth: 3
        toc_float: true
        embed-resources:  true
        code-block-bg: true
        code-block-border-left: "#31BAE9"       
        indent: true
        number-sections: true
        number-depth: 3
        number-offset: 2
        code-link: true             # hyperlink R functions
        html-math-method: katex
        css:  styles.css
execute:
    error: true 
    warning: true
    collapse: true 
    standalone: true
output-dir: docs            ## NO indent, also _quarto.yml for entier project
---

***
This is [DEEPER]{style="color: red;"} HELPER version of 0088_  
[0088 is more streamlined.]{style="background-color: yellow"}.  
Rscripts/jim Tools - is intended for daily produciton

***

### PURPOSE:    Update R packages

Outline:  

    -   Check R version, sessionInfo
    -   Check current R library locations, 
    -   Review packages each library
    -   Identify packages in more than ONE directory
    -   (interactive only) update `old` packages (compiled with older R versions)
    -   (interactive only) update any remaining packages
    -   list Env variables
    
Functions:  

    -   update
    -   upgrade
    -   installed.packages
    -   find.package
    -   knitr functions:  <https://cran.r-project.org/web//packages/knitr/knitr.pdf>


### all installed , 266 (with dup)
<!-- {{{ -->
```{r}
library(data.table)
installed = installed.packages()
dt  <- data.table::as.data.table(installed)
setkey(dt, "Package", "LibPath")
key(dt) # [1] "Package"

head(dt)[1:3,1:3 ]
dim(installed) # [1] 266  16
```<!-- }}} -->

### installed in user dir
<!-- {{{ -->
```{r}
.libPaths()
dt_user = dt[LibPath == .libPaths()[[1]]]
key(dt_user)
dim(dt_user) # [1] 237  16

```<!-- }}} -->

### installed in system dir
<!-- {{{ -->
```{r}
dt_sys = dt[LibPath == .libPaths()[[2]]]
dim(dt_sys) # [1] 29 16
```<!-- }}} -->

### unique packages, ~ 9 duplicates
<!-- {{{ -->
```{r}
data.table::uniqueN(dt$Package) # [1] 257
data.table::uniqueN(dt_user$Package) # [1] 237
data.table::uniqueN(dt_sys$Package) # [1] 29
```<!-- }}} -->


REF: https://medium.com/analytics-vidhya/r-data-table-joins-48f00b46ce29
Notation:
  on=.(x,y)
  on=.(x < 5, y> y)  non-equi join
  on=.(...), z := ...   adds column (in reference, no copy)


### Packages in both, 9
<!-- {{{ -->
```{r}
if (F ){   # NO !
# equi-join, Package in both , 29  
  dt_user[dt_sys, on=.(Package == Package)][, 1]
  dt_user[dt_sys, on=.(Package == Package), nomatch=NA][, 1] # 29
}
# use inner_join
dt_user[dt_sys, on=.(Package == Package), nomatch=NULL][, c(1,2)] # 9
dt_sys[dt_user, on=.(Package == Package), nomatch=NULL][, c(1,2)] # 9

# !=  is NOT allowed
if false dt1[dt2, on=.(Package != Package)][, 1]

# anti-join, all packages in dt_user, not in dt_sys
dt_user[!dt_sys, on = .(Package)][, c(1,2)] # 228

# anti , packages in dt_sys, not in dt_user
dt_sys[!dt_user, on = .(Package)][, c(1,2)] # 20


# A[B, on=.(id), which=T]  returns index only

# check
dt_user[Package=="base"] ; 
  dt_sys[Package=="base"]
dt_user[Package=="boot"]
dt_user[Package=="compiler"]
dt_user[Package=="class"]  # y
```
<!-- }}} -->

Of 29 packaes in dt_sys, 9 are ALSO in dt_user (20 are not)
<!-- {{{ -->
```{r}
str(dt)
# Classes ‘data.table’ and 'data.frame':	266 obs. of  16 variables:
#  $ Package              : chr  "AsioHeaders" "BH" "DiceDesign" "GPfit" ...
#  $ LibPath              : chr  "/home/jim/R/x86_64-pc-linux-gnu-library/4.3" "/home/jim/R/x86_64-pc-linux-gnu-library/4.3" "/home/jim/R/x86_64-pc-linux-gnu-library/4.3" "/home/jim/R/x86_64-pc-linux-gnu-library/4.3" ...
#  $ Version              : chr  "1.22.1-2" "1.81.0-1" "1.9" "1.0-8" ...
#  $ Priority             : chr  NA NA NA NA ...
#  $ Depends              : chr  NA NA "R (>= 2.10)" NA ...
#  $ Imports              : chr  NA NA NA "lhs (>= 0.5), lattice (>= 0.18-8)" ...
#  $ LinkingTo            : chr  NA NA NA NA ...
#  $ Suggests             : chr  NA NA "rgl, randtoolbox, lattice" "testthat" ...
#  $ Enhances             : chr  NA NA NA NA ...
#  $ License              : chr  "BSL-1.0" "BSL-1.0" "GPL-3" "GPL-2" ...
#  $ License_is_FOSS      : chr  NA NA NA NA ...
#  $ License_restricts_use: chr  NA NA NA NA ...
#  $ OS_type              : chr  NA NA NA NA ...
#  $ MD5sum               : chr  NA NA NA NA ...
#  $ NeedsCompilation     : chr  "no" "no" "yes" "no" ...
#  $ Built                : chr  "4.3.1" "4.3.0" "4.3.1" "4.3.1" ...
#  - attr(*, ".internal.selfref")=<externalptr> 
#  - attr(*, "sorted")= chr "Package"
#  - attr(*, "index")= int(0) 
#   ..- attr(*, "__LibPath")= int [1:266] 1 2 3 4 5 6 7 9 11 13 ...
# NULL
```
<!-- }}} -->


