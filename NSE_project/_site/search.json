[
  {
    "objectID": "010_mtcars_basic.html",
    "href": "010_mtcars_basic.html",
    "title": "mtcars_basic",
    "section": "",
    "text": "A frequent problem occurs when trying to access columns inside a data.frame.\n\nlibrary(tibble)\n#| errors:  true\nhead(mtcars)\n\n                   mpg cyl disp  hp drat    wt  qsec vs am gear carb\nMazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\nMazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\nDatsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\nHornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\nHornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\nValiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1\n\nmtcars[1:5, c(\"hp\")]\n\n[1] 110 110  93 110 175\n\n\nBut using just col name fails.\n\nmtcars[1:5, hp]\n\nError in `[.data.frame`(mtcars, 1:5, hp): object 'hp' not found\n\n\nThe reason as explained in many places, such as dplyr ….., is mtcars exists in the environment, but not hp.\n\nhp\n\nError in eval(expr, envir, enclos): object 'hp' not found\n\n\nAgain this is explained in many places, along with several ways to fix, for example.\n\nwith(mtcars, hp)\n\n [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52\n[20]  65  97 150 150 245 175  66  91 113 264 175 335 109\n\n\nOf course, R’s help also explains this but you must be comfortable with terms like environment , expression and parent and what constructing an environment with data means.\n\n?with\n\nAnd where does “mtcars” live? I happen to know it is in packages on search tree: “package:datasets”\n\nexists(\"mtcars\",\n       envir = as.environment(\"package:datasets\"),\n       inherits = FALSE)\n\n[1] TRUE\n\n# alas, not hp\nexists(\"hp\",\n       envir = as.environment(\"package:datasets\"),\n       inherits = T)\n\n[1] FALSE\n\n\n\nany(sapply(1:(which(search() == \"tools:rstudio\") - 1L),\n           function(pp) exists(\"mtcars\",  where = pp, inherits = FALSE)))\n\nError in 1:(which(search() == \"tools:rstudio\") - 1L): argument of length 0\n\n(which(search() == \"tools:rstudio\") -1L )\n\ninteger(0)\n\nwhich(search() == \".GlobalEnv\")\n\n[1] 1\n\nwhich(search() == \"package:base\")\n\n[1] 10\n\n# print vertically\nsearch() |&gt; tibble() |&gt; print(n=length(search()))\n\n# A tibble: 10 × 1\n   `search()`       \n   &lt;chr&gt;            \n 1 .GlobalEnv       \n 2 package:tibble   \n 3 package:stats    \n 4 package:graphics \n 5 package:grDevices\n 6 package:utils    \n 7 package:datasets \n 8 package:methods  \n 9 Autoloads        \n10 package:base     \n\n\nfrom !so, next hook to search()\n\nis.defined &lt;- function(sym) {\n  sym &lt;- deparse(substitute(sym))\n  env &lt;- parent.frame()\n  exists(sym, env)\n}\n\nis.defined(a)\n\n[1] FALSE\n\n# FALSE\na &lt;- 10\nis.defined(a)\n\n[1] TRUE\n\n# TRUE\n\nHere is my own take. It is same as above, but I find this way clearer.\nLet’s check what is current globalenv() the the environment. Then packages attached to search path.\n\nls()\n\n[1] \"a\"               \"has_annotations\" \"is.defined\"     \n\nsearch()\n\n [1] \".GlobalEnv\"        \"package:tibble\"    \"package:stats\"    \n [4] \"package:graphics\"  \"package:grDevices\" \"package:utils\"    \n [7] \"package:datasets\"  \"package:methods\"   \"Autoloads\"        \n[10] \"package:base\"     \n\n\nFor our purposes, note there is no hp\n\nls(base)\n\nWarning in ls(base): 'base' converted to character string\n\n\nError in as.environment(pos): no item called \"base\" on the search list\n\nls(\"package:base\") |&gt; grep(pattern=c(\"mtcars\"))\n\ninteger(0)\n\n\nAttach mtcars to search path\n\nattach(mtcars)\nsearch()\n\n [1] \".GlobalEnv\"        \"mtcars\"            \"package:tibble\"   \n [4] \"package:stats\"     \"package:graphics\"  \"package:grDevices\"\n [7] \"package:utils\"     \"package:datasets\"  \"package:methods\"  \n[10] \"Autoloads\"         \"package:base\"     \n\n\nNow, can find hp\n\nhp\n\n [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52\n[20]  65  97 150 150 245 175  66  91 113 264 175 335 109\n\n\nWhy? col names are in environment one level up from globalenv()\n\nls(parent.env(globalenv()))\n\n [1] \"am\"   \"carb\" \"cyl\"  \"disp\" \"drat\" \"gear\" \"hp\"   \"mpg\"  \"qsec\" \"vs\"  \n[11] \"wt\"  \n\n\nThis will add mtcars into globalenv(), but not change search()\n\n?data\n# This puts data in globalenv()\ndata(mtcars)\nls()\n\n[1] \"a\"               \"has_annotations\" \"is.defined\"      \"mtcars\"         \n\nsearch()\n\n [1] \".GlobalEnv\"        \"mtcars\"            \"package:tibble\"   \n [4] \"package:stats\"     \"package:graphics\"  \"package:grDevices\"\n [7] \"package:utils\"     \"package:datasets\"  \"package:methods\"  \n[10] \"Autoloads\"         \"package:base\"     \n\n\nRemove mtcars\n\nrm(mtcars)\nls()\n\n[1] \"a\"               \"has_annotations\" \"is.defined\"     \n\nmtcars[1:5, ]\n\n                   mpg cyl disp  hp drat    wt  qsec vs am gear carb\nMazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4\nMazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4\nDatsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1\nHornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1\nHornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2\n\nls()\n\n[1] \"a\"               \"has_annotations\" \"is.defined\"     \n\n\nvim:conceallevel=0"
  }
]